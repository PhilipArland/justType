<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>JustType</title>
    <link href="assets/img/logo/logo.png" rel="icon">
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
</head>

<body class="text-white">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg py-4">
        <div class="container">
            <a class="navbar-brand text-white fw-bold fs-2 text-uppercase letter-spacing-2" href="#">
                Just Type
                <span class="logo-icon ms-2">
                    <i class="bi bi-keyboard"></i>
                </span>
            </a>
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <i class="bi bi-list text-white fs-4"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link text-white fs-5 px-3 mx-lg-2" href="#" id="nav-home">
                            <i class="bi bi-house me-2"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white fs-5 px-3 mx-lg-2" href="#" id="nav-leaderboard">
                            <i class="bi bi-trophy me-2"></i>Leaderboard
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container game-container center">
        <div class="game">
            <!-- Name Input Section -->
            <div id="name-section" class="row justify-content-center align-items-center" style="min-height: 60vh;">
                <div class="col-12 col-md-8 col-lg-6">
                    <div class="text-center">
                        <h5 class="fw-light text-light mb-3">Enter Name to Play the Game!</h5>
                        <form id="gameForm" class="d-flex flex-column align-items-center gap-4">
                            <div class="w-100 d-flex justify-content-center">
                                <input type="text" class="form-control text-center border-0 py-2" id="playerName"
                                    placeholder="Enter Name" required>
                            </div>
                            <button type="submit" class="btn btn-game btn px-5 fw-semibold">
                                <i class="bi bi-play-circle me-2"></i>Submit
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div id="game-section" class="d-none text-center my-5 game-section">
                <p id="sentence"></p>
                <p id="progress" class="text-info"></p>
            </div>
        </div>

        <!-- Typing Game Section -->

        <!-- Leaderboard Section -->
        <div id="leaderboard-section" class="d-none my-5">
            <h3 class="text-center mb-4">Leaderboard</h3>
            <table class="table table-dark table-striped text-center">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Name</th>
                        <th>Time (seconds)</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body"></tbody>
            </table>
        </div>
    </div>

    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script>
        const sentences = [
            "more feel here only see after people by move govern do from thing fact most person give out she also day too be have see play no they only govern line can people again at just so few before, more feel here only see after people by move govern do from thing fact most person give out she also day too be have see play no they only govern line can people again at just so few before"
        ];

        const form = document.getElementById("gameForm");
        const nameSection = document.getElementById("name-section");
        const gameSection = document.getElementById("game-section");
        const sentenceEl = document.getElementById("sentence");
        const progressEl = document.getElementById("progress");

        let sentence = "";
        let currentIndex = 0;
        let startTime;

        form.addEventListener("submit", function (e) {
            e.preventDefault();

            nameSection.classList.add("d-none");
            gameSection.classList.remove("d-none");

            sentence = sentences[0];
            currentIndex = 0;
            startTime = null;
            renderSentence();
            document.addEventListener("keydown", handleTyping);
        });

        let typedChars = [];

        function renderSentence() {
            let html = "";
            for (let i = 0; i < sentence.length; i++) {
                if (i < typedChars.length) {
                    if (typedChars[i] === sentence[i]) {
                        html += `<span class="correct">${sentence[i]}</span>`;
                    } else {
                        html += `<span class="incorrect">${sentence[i]}</span>`;
                    }
                } else if (i === typedChars.length) {
                    html += `<span class="current">${sentence[i]}</span>`;
                } else {
                    html += `<span class="remaining">${sentence[i]}</span>`;
                }
            }

            // Put inside inner wrapper
            sentenceEl.innerHTML = `<div id="sentence-inner">${html}</div>`;
            const inner = document.getElementById("sentence-inner");

            // --- Measure actual line position ---
            const currentCharEl = inner.querySelector(".current");
            const containerTop = sentenceEl.getBoundingClientRect().top;
            const currentTop = currentCharEl.getBoundingClientRect().top;
            const lineHeightPx = parseFloat(getComputedStyle(sentenceEl).lineHeight);

            // Which line number is current char on? (0 = first line)
            const currentLine = Math.floor((currentTop - containerTop) / lineHeightPx);

            // Scroll only if current line is 2 or more (3rd visual line)
            let shiftLines = 0;
            if (currentLine >= 2) {
                shiftLines = currentLine - 1; // keep cursor on 2nd line
            }

            inner.style.transform = `translateY(${-shiftLines * lineHeightPx}px)`;
            // ------------------------------------

            progressEl.textContent = `${typedChars.length}/${sentence.length}`;
        }




        function handleTyping(e) {
            if (!startTime) startTime = Date.now();

            if (e.key === "Backspace") {
                if (typedChars.length > 0) {
                    typedChars.pop();
                    currentIndex--;
                    renderSentence();
                }
                return;
            }

            if (e.key.length !== 1) return;

            typedChars.push(e.key);
            currentIndex++;

            renderSentence();
            if (typedChars.length === sentence.length) endGame();
        }



        function endGame() {
            const timeTaken = ((Date.now() - startTime) / 1000).toFixed(2);
            progressEl.textContent = `Completed in ${timeTaken} seconds!`;
            document.removeEventListener("keydown", handleTyping);
        }
    </script>


</body>

</html>