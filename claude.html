<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Just Type</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css"
        rel="stylesheet">

</head>

<style>
    #sentence {
        font-family: monospace;
        white-space: pre-wrap;
        color: #646669;
        text-align: justify;

        display: -webkit-box;
        -webkit-line-clamp: 3;
        /* show only 3 lines */
        -webkit-box-orient: vertical;
        overflow: hidden;
        position: relative;
    }


    .correct {
        color: #ededed;
        /* Green for correct */
    }

    .incorrect {
        color: #f00;
        /* Red for incorrect */
    }

    .current {
        position: relative;
        color: transparent;
        /* hide actual char so caret replaces it */
    }

    .current::before {
        content: attr(data-char);
        /* optional preview of next char */
        color: #646669;
    }

    .current::after {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 2px;
        background-color: yellow;
        animation: blink 1s step-start infinite;
    }

    @keyframes blink {
        50% {
            opacity: 0;
        }
    }
</style>

<body class="text-white">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg py-4">
        <div class="container">
            <a class="navbar-brand text-white fw-bold fs-2 text-uppercase letter-spacing-2" href="#">
                Just Type
                <span class="logo-icon ms-2">
                    <i class="bi bi-keyboard"></i>
                </span>
            </a>

            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <i class="bi bi-list text-white fs-4"></i>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link text-white fs-5 px-3 mx-lg-2" href="#">
                            <i class="bi bi-house me-2"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white fs-5 px-3 mx-lg-2" href="#">
                            <i class="bi bi-trophy me-2"></i>Leaderboard
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Game Section -->
    <div class="container">
        <div class="row justify-content-center align-items-center" style="min-height: 60vh;">
            <div class="col-12 col-md-8 col-lg-6">
                <div class="text-center">
                    <h1 class="display-6 fw-light text-light mb-5">Enter Name to Play the Game!</h1>

                    <form id="gameForm" class="d-flex flex-column align-items-center gap-4">
                        <div class="w-100 d-flex justify-content-center">
                            <input type="text" class="form-control form-control-lg game-input text-center border-0"
                                id="playerName" placeholder="Enter Name" required>
                        </div>

                        <button type="submit" class="btn btn-game btn-lg px-5 py-3 rounded-pill fw-semibold">
                            <i class="bi bi-play-circle me-2"></i>Submit
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        const sentences = [
            "It was a bright cold day in April, and the clocks were striking thirteen. Julia hurried down the narrow street, her coat pulled tightly around her against the bitter wind. She could feel the eyes of the posters on the wall following her every step, their bold black letters whispering warnings she dared not ignore. Somewhere in the distance, a dog barked, and the sound echoed through the empty city like a lonely call for help. But Julia kept walking, knowing that to stop would mean to think, and to think might mean to remember things better left forgotten."
        ];

        let playerName = "";
        let currentSentenceIndex = 0;
        let startTime;
        let currentCharIndex = 0;
        let typedText = "";

        const nameSection = document.getElementById('name-section');
        const gameSection = document.getElementById('game-section');
        const leaderboardSection = document.getElementById('leaderboard-section');

        const sentenceEl = document.getElementById('sentence');
        const progressEl = document.getElementById('progress');

        document.getElementById('gameForm').addEventListener('submit', function (e) {
            e.preventDefault();
            playerName = document.getElementById('playerName').value.trim();
            if (playerName) {
                nameSection.classList.add('d-none');
                gameSection.classList.remove('d-none');
                startGame();
            }
        });

        function startGame() {
            currentSentenceIndex = 0;
            currentCharIndex = 0;
            typedText = "";
            renderSentence();
            progressEl.textContent = "";
            startTime = new Date().getTime();
            document.addEventListener('keydown', handleTyping);
        }

        function handleTyping(e) {
            const currentSentence = sentences[currentSentenceIndex];

            if (e.key.length === 1) {
                typedText += e.key;
                currentCharIndex++;
            } else if (e.key === "Backspace") {
                typedText = typedText.slice(0, -1);
                currentCharIndex = Math.max(currentCharIndex - 1, 0);
            }

            updateCaretPosition();

            if (typedText === currentSentence) {
                document.removeEventListener('keydown', handleTyping);
                endGame();
            }
        }

        function renderSentence() {
            const sentence = sentences[currentSentenceIndex];

            // Build the full sentence once
            let html = "";
            for (let i = 0; i < sentence.length; i++) {
                html += `<span data-index="${i}" class="char">${sentence[i]}</span>`;
            }
            sentenceEl.innerHTML = html;

            // Add caret span separately so it won't be destroyed on updates
            const caret = document.createElement("span");
            caret.classList.add("current");
            caret.setAttribute("data-char", sentence[0]); // first char preview
            sentenceEl.insertBefore(caret, sentenceEl.firstChild);
        }

        function updateCaretPosition() {
            const sentence = sentences[currentSentenceIndex];
            const caret = document.querySelector(".current");
            const chars = document.querySelectorAll(".char");

            // Keep caret always in DOM, just move it
            if (typedText.length < sentence.length) {
                caret.setAttribute("data-char", sentence[typedText.length]);
                const targetChar = chars[typedText.length];
                const rect = targetChar.getBoundingClientRect();
                const parentRect = sentenceEl.getBoundingClientRect();
                caret.style.transform = `translateX(${rect.left - parentRect.left}px)`;
            } else {
                caret.setAttribute("data-char", " ");
                const lastChar = chars[chars.length - 1];
                const rect = lastChar.getBoundingClientRect();
                const parentRect = sentenceEl.getBoundingClientRect();
                caret.style.transform = `translateX(${rect.right - parentRect.left}px)`;
            }

            // Update typed chars color
            for (let i = 0; i < chars.length; i++) {
                if (i < typedText.length) {
                    chars[i].className = (typedText[i] === sentence[i]) ? "char correct" : "char incorrect";
                } else {
                    chars[i].className = "char";
                }
            }
        }

        function endGame() {
            const endTime = new Date().getTime();
            const totalTime = ((endTime - startTime) / 1000).toFixed(2);

            let leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
            leaderboard.push({ name: playerName, time: parseFloat(totalTime) });
            leaderboard.sort((a, b) => a.time - b.time);
            localStorage.setItem('leaderboard', JSON.stringify(leaderboard));

            showLeaderboard();
        }

        function showLeaderboard() {
            gameSection.classList.add('d-none');
            leaderboardSection.classList.remove('d-none');
            const leaderboard = JSON.parse(localStorage.getItem('leaderboard')) || [];
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = "";
            leaderboard.forEach((entry, index) => {
                tbody.innerHTML += `
            <tr>
                <td>${index + 1}</td>
                <td>${entry.name}</td>
                <td>${entry.time}</td>
            </tr>
        `;
            });
        }
    </script>
</body>

</html>